Most test suites have been disabled in https://github.com/elastic/e2e-testing/pull/3054 and https://github.com/elastic/e2e-testing/pull/3077. Next, we should evaluate the value of the tests that were disabled, fix any underlying problems, and determine which platforms to run them on. Here's my quick and dirty assessment, roughly prioritized:

- [ ] APM Integration
  - Previously running on Debian 10 amd64
  - This tests that adding the APM integration in the UI results in the apm-server process
    running
  - Discussed this with @simitt and they'd be ok with removing this test entirely. They have other smoke tests that verify that managed APM on ESS works correctly and they have short-term plans to expand that coverage to test managed APM on other OSes: https://github.com/elastic/apm-server/issues/9184

- [x] (running_on_beats) Backend Processes: verify that the Agent-managed Beats actually start up and shutdown with agent
  - A better test would verify that data is shipped instead of relying on the implementation detail of Beats
    - If that way the same test would work for V2/Inputs/Shipper, I agree, if not I'd keep beats specific tests for the older versions of the agent
  - Previously running on Debian 10 amd64, Debian 10 arm64, sles15

- [x] Endpoint integration - Anderson
  - re-enable, see if they're flaky

- [ ] Fleet mode - Anderson

- [ ] Linux Integration
  - Previously running on Debian 10 amd64, Debian 10 arm64, sles15
  - Makes sense to run these on a few different Linux flavors, but not on the PR, just the daily job.

- [ ] Integrations
  - Previously running on Debian 11 amd64
  - This only seems to test Kibana features from what I can tell, can probably be removed entirely.

- [ ] Permissions Output change
  - Previously running on Debian 10 amd64, Debian 10 arm64, sles15
  - Don't see why these need to run on more than one platform
  - Maybe a candidate for removal from e2e or moved to a Fleet Server integration test
    - Update them to ensure the API key permission is updated accordingly. But better move to fleet-server integration test

- [ ] Pre configured policy - Anderson
  - It's a Kibana / Fleet Server test

- [ ] Running on top of beats / Beats Background Processes
  - These verify that Agent and Beats can run on the same machine without problems
  - Will we need it for V2/Shipper/Inputs
  - Previously running on Debian 10 amd64, Debian 10 arm64, sles15

- [ ] Standalone mode
  - These need to be re-enabled
  - Previously running on Debian 10 amd64, Debian 10 arm64

- [ ] System Integration - Anderson

- [ ] Upgrade tests
    - We need to fix an issue where the upgrade tests attempt to download old snapshots that are no longer available. For instance, the 8.4 upgrade test is currently trying to upgrade to 8.4.0-SNAPSHOT, instead of 8.4.3-SNAPSHOT.
    - We should get these working on macOS and Windows

IMO I don't see why we need to run any of these test suites on more than one Linux platform with the exception of the Linux Integration tests.

We probably don't need the mix of Debian 10 and 11 and can just go with 11 or even Ubuntu 22.


My take:
 - (Re)enable on for the branch `feature-debug-e2e-tests` the [ci job](https://beats-ci.elastic.co/blue/organizations/jenkins/e2e-tests%2Fe2e-testing-mbp/activity?branch=feature-debug-e2e-tests), for a single platform, in the following order the tests:
   - Upgrade tests -> ensure it runs for the latest version: add 8.5, 8.6, 8.7-SNAPSHOT
   - Endpoint integration
   - System Integration
   - Linux Integration
   - Standalone mode
 
 - With the job enabled, find flaky tests and fix or remove them
 - Start adding more systems and Linux flavours as the tests become stable

 - Clean up / readability improvements:
   - a .go file for every .feature file, both in the same folder
   - under _suites/[suite-name]/*.go, .go files that are generic, shared code. No test code

 - Replace APM and Endpoint integration with a single feature (.feature file) ensuring the agent starts and stops all programs it can run
   - the agent starts with a policy containing everything it can run
   - remove the agent and ensure everything else was removed as well.
 - Create specific features for specific programs (eg. Endpoint Security)